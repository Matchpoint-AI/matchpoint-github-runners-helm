# Values file for Matchpoint Beta runners (Python with persistent storage)
# Deploy with: helm install arc-beta-runners ./charts/github-actions-runners -f examples/beta-runners-values.yaml

gha-runner-scale-set:
  # Controller service account configuration
  controllerServiceAccount:
    namespace: arc-systems
    name: arc-gha-rs-controller
  githubConfigUrl: "https://github.com/Matchpoint-AI/project-beta"
  runnerScaleSetName: "arc-beta-runners"

  githubConfigSecret:
    github_token: "YOUR_GITHUB_TOKEN_HERE"  # Overridden by ArgoCD

  minRunners: 1      # Keep at least 1 runner warm
  maxRunners: 20

  # Security context for beta runners - removed to allow runner to work properly
  # securityContext:
  #   fsGroup: 123

  template:
    spec:
      containers:
      - name: runner
        image: ghcr.io/actions/actions-runner:latest
        imagePullPolicy: IfNotPresent  # Faster startup
        command:
        - /home/runner/run.sh
        env:
        - name: ACTIONS_RUNNER_REQUIRE_JOB_CONTAINER
          value: "false"
        - name: ACTIONS_RUNNER_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: NODE_OPTIONS
          value: "--max-old-space-size=8192"  # Increased memory
        - name: PYTHONUNBUFFERED
          value: "1"
        - name: PIP_CACHE_DIR
          value: "/home/runner/_work/_pip-cache"
        resources:
          requests:
            cpu: "2"      # Reduced for cluster capacity
            memory: 4Gi   # Reduced for cluster capacity
          limits:
            cpu: "4"      # Reduced for cluster capacity
            memory: 8Gi   # Reduced for cluster capacity
        volumeMounts:
        - name: work
          mountPath: /home/runner/_work
        - name: build-cache
          mountPath: /home/runner/_work/_cache
      restartPolicy: Never
      volumes:
      - name: work
        ephemeral:
          volumeClaimTemplate:
            spec:
              accessModes:
              - ReadWriteOnce
              resources:
                requests:
                  storage: 20Gi
              storageClassName: ssd
      - name: build-cache
        emptyDir:
          sizeLimit: 15Gi