# Values file for Matchpoint frontend runners
# Deploy with: helm install arc-frontend-runners ./charts/github-actions-runners -f examples/frontend-runners-values.yaml

gha-runner-scale-set:
  # Controller service account configuration
  controllerServiceAccount:
    namespace: arc-systems
    name: arc-gha-rs-controller
  githubConfigUrl: "https://github.com/Matchpoint-AI/project-beta-frontend"
  runnerScaleSetName: "arc-frontend-runners"

  githubConfigSecret:
    github_token: "YOUR_GITHUB_TOKEN_HERE"  # Replace with actual token

  minRunners: 2      # Increased for pre-warming
  maxRunners: 15

  template:
    spec:
      containers:
      - name: runner
        image: ghcr.io/actions/actions-runner:latest
        imagePullPolicy: IfNotPresent  # Faster startup
        command:
        - /home/runner/run.sh
        env:
        - name: ACTIONS_RUNNER_LABELS
          value: "arc-frontend-runners,self-hosted,linux,x64"
        - name: RUNNER_NAME_PREFIX
          value: "arc-frontend"
        - name: ACTIONS_RUNNER_REQUIRE_JOB_CONTAINER
          value: "false"
        - name: DOCKER_HOST
          value: "tcp://localhost:2375"
        - name: NODE_OPTIONS
          value: "--max-old-space-size=8192"  # Increased memory
        - name: NPM_CONFIG_CACHE
          value: "/home/runner/_work/_npm-cache"
        resources:
          requests:
            cpu: "4"      # Upgraded to large profile
            memory: 8Gi   # Upgraded to large profile
          limits:
            cpu: "6"      # Upgraded to large profile
            memory: 12Gi  # Upgraded to large profile
        volumeMounts:
        - name: work
          mountPath: /home/runner/_work
        - name: npm-cache
          mountPath: /home/runner/_work/_npm-cache
        - name: docker-certs
          mountPath: /certs/client
          readOnly: true
      - name: dind
        image: docker:24-dind
        command:
        - dockerd
        args:
        - --host=tcp://0.0.0.0:2375
        - --storage-driver=overlay2
        env:
        - name: DOCKER_TLS_CERTDIR
          value: ""
        resources:
          requests:
            cpu: "2"      # Upgraded for faster Docker builds
            memory: 4Gi   # Upgraded for faster Docker builds
          limits:
            cpu: "4"      # Upgraded for faster Docker builds
            memory: 8Gi   # Upgraded for faster Docker builds
        securityContext:
          privileged: true
        volumeMounts:
        - name: docker-storage
          mountPath: /var/lib/docker
        - name: docker-certs
          mountPath: /certs/client
      restartPolicy: Never
      volumes:
      - name: work
        emptyDir:
          sizeLimit: 25Gi
      - name: npm-cache
        emptyDir:
          sizeLimit: 10Gi
      - name: docker-storage
        emptyDir:
          sizeLimit: 20Gi
      - name: docker-certs
        emptyDir: {}